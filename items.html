<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Å–µ –≤–µ—â–∏ - Rentify</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navbar (—Ç–æ—Ç –∂–µ —á—Ç–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π) -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <a href="index.html" class="logo">Rentify</a>
                <div class="nav-menu">
                    <a href="items.html">–í—Å–µ –≤–µ—â–∏</a>
                    <a href="add-item.html">–î–æ–±–∞–≤–∏—Ç—å –≤–µ—â—å</a>
                    <a href="login.html" class="btn-login">–í–æ–π—Ç–∏</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Page Content -->
    <div class="container" style="padding: 2rem 0;">
        <!-- Breadcrumbs -->
        <div id="breadcrumbs" style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px; color: #6b7280; font-size: 0.9rem;">
            <a href="index.html" style="color: #4f46e5; text-decoration: none;">–ì–ª–∞–≤–Ω–∞—è</a>
            <span>/</span>
            <span id="breadcrumbCategory">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
        </div>

        <h1 id="pageTitle" style="margin-bottom: 2rem;">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h1>
        
        <!-- Category View (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) -->
        <div id="categoryView" style="display: none;">
            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem;">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                <div id="subcategoryList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                    <!-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>

        <!-- Filters (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Ç–æ–≤–∞—Ä–æ–≤) -->
        <div id="filtersSection" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: none;">
            <h3 style="margin-bottom: 1rem;">–§–∏–ª—å—Ç—Ä—ã</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                <select id="subcategoryFilter" style="padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px;">
                    <option value="">–í—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                </select>
                <input type="number" id="priceFrom" placeholder="–¶–µ–Ω–∞ –æ—Ç" style="padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px;">
                <input type="number" id="priceTo" placeholder="–¶–µ–Ω–∞ –¥–æ" style="padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px;">
            </div>
            <button id="applyFilters" class="btn btn-primary" style="width: 100%;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
        </div>

        <!-- Items Grid -->
        <div class="items-grid" id="allItems">
            <!-- Items will be loaded by JavaScript -->
        </div>
    </div>

    <!-- Item Detail Modal -->
    <div id="itemDetailModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; overflow-y:auto;">
        <div style="max-width:800px; margin:2rem auto; background:white; border-radius:12px; position:relative; padding:2rem;">
            <button id="closeDetailModal" style="position:absolute; top:1rem; right:1rem; background:none; border:none; font-size:2rem; cursor:pointer; color:#999;">&times;</button>
            <div id="itemDetailContent">
                <!-- Content will be loaded by JS -->
            </div>
            <button id="contactOwnerBtn" class="btn btn-primary" style="width:100%; margin-top:1.5rem; padding:1rem; font-size:1.1rem;">
                <i class="fas fa-comment-dots"></i> –ù–∞–ø–∏—Å–∞—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü—É
            </button>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1001;">
        <div style="max-width:500px; margin:2rem auto; background:white; border-radius:12px; position:relative; height:600px; display:flex; flex-direction:column;">
            <!-- Chat Header -->
            <div style="padding:1rem; border-bottom:1px solid #e5e7eb; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h3 id="chatOwnerName" style="margin:0; font-size:1.1rem;">–ß–∞—Ç —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º</h3>
                    <p id="chatItemName" style="margin:0.25rem 0 0 0; font-size:0.85rem; color:#6b7280;"></p>
                </div>
                <button id="closeChatModal" style="background:none; border:none; font-size:2rem; cursor:pointer; color:#999;">&times;</button>
            </div>

            <!-- Chat Messages -->
            <div id="chatMessages" style="flex:1; padding:1rem; overflow-y:auto; background:#f9fafb;">
                <!-- Messages will be loaded here -->
            </div>

            <!-- Chat Input -->
            <div style="padding:1rem; border-top:1px solid #e5e7eb; background:white;">
                <div style="display:flex; gap:0.5rem;">
                    <input type="text" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1; padding:0.75rem; border:1px solid #e5e7eb; border-radius:8px;">
                    <button id="sendMessageBtn" class="btn btn-primary" style="padding:0.75rem 1.5rem;">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 class="footer-logo">Rentify</h3>
                    <p>–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞—Ä–µ–Ω–¥—ã –≤–µ—â–µ–π –º–µ–∂–¥—É –ª—é–¥—å–º–∏.</p>
                </div>
                <div class="footer-section">
                    <h4>–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h4>
                    <a href="items.html">–í—Å–µ –≤–µ—â–∏</a>
                    <a href="add-item.html">–î–æ–±–∞–≤–∏—Ç—å –≤–µ—â—å</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Rentify. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
        const categories = {
            electronics: { label: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', icon: 'üíª' },
            clothing: { label: '–û–¥–µ–∂–¥–∞', icon: 'üëï' },
            sports: { label: '–°–ø–æ—Ä—Ç', icon: '‚öΩ' },
            auto: { label: '–ê–≤—Ç–æ', icon: 'üöó' },
            tools: { label: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', icon: 'üîß' },
            furniture: { label: '–ú–µ–±–µ–ª—å', icon: 'üõãÔ∏è' }
        };

        const subcategories = {
            electronics: [
                { value: 'phones', label: '–¢–µ–ª–µ—Ñ–æ–Ω—ã' },
                { value: 'computers', label: '–ö–æ–º–ø—å—é—Ç–µ—Ä—ã' },
                { value: 'cameras', label: '–ö–∞–º–µ—Ä—ã' },
                { value: 'audio', label: '–ê—É–¥–∏–æ' },
                { value: 'tv', label: '–¢–í –∏ –≤–∏–¥–µ–æ' }
            ],
            clothing: [
                { value: 'men', label: '–ú—É–∂—Å–∫–∞—è' },
                { value: 'women', label: '–ñ–µ–Ω—Å–∫–∞—è' },
                { value: 'kids', label: '–î–µ—Ç—Å–∫–∞—è' },
                { value: 'accessories', label: '–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã' }
            ],
            sports: [
                { value: 'fitness', label: '–§–∏—Ç–Ω–µ—Å' },
                { value: 'bicycles', label: '–í–µ–ª–æ—Å–∏–ø–µ–¥—ã' },
                { value: 'winter', label: '–ó–∏–º–Ω–∏–π —Å–ø–æ—Ä—Ç' },
                { value: 'water', label: '–í–æ–¥–Ω—ã–π —Å–ø–æ—Ä—Ç' },
                { value: 'camping', label: '–¢—É—Ä–∏–∑–º' }
            ],
            auto: [
                { value: 'cars', label: '–ê–≤—Ç–æ–º–æ–±–∏–ª–∏' },
                { value: 'motorcycles', label: '–ú–æ—Ç–æ—Ü–∏–∫–ª—ã' },
                { value: 'scooters', label: '–°–∫—É—Ç–µ—Ä—ã' },
                { value: 'accessories', label: '–ê–≤—Ç–æ–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã' }
            ],
            tools: [
                { value: 'power', label: '–≠–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç' },
                { value: 'hand', label: '–†—É—á–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç' },
                { value: 'garden', label: '–°–∞–¥–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞' },
                { value: 'construction', label: '–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ' }
            ],
            furniture: [
                { value: 'living', label: '–ì–æ—Å—Ç–∏–Ω–∞—è' },
                { value: 'bedroom', label: '–°–ø–∞–ª—å–Ω—è' },
                { value: 'office', label: '–û—Ñ–∏—Å–Ω–∞—è' },
                { value: 'outdoor', label: '–£–ª–∏—á–Ω–∞—è' }
            ]
        };

        let currentCategory = null;
        let currentSubcategory = null;

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function showCategoryView(category) {
            currentCategory = category;
            const categoryData = categories[category];
            
            document.getElementById('pageTitle').textContent = categoryData.label;
            document.getElementById('breadcrumbCategory').textContent = categoryData.label;
            document.getElementById('categoryView').style.display = 'block';
            document.getElementById('filtersSection').style.display = 'none';
            document.getElementById('allItems').innerHTML = '';

            const subcategoryList = document.getElementById('subcategoryList');
            subcategoryList.innerHTML = '';

            subcategories[category].forEach(sub => {
                const card = document.createElement('a');
                card.href = `?category=${category}&subcategory=${sub.value}`;
                card.style.cssText = 'display: block; padding: 1.5rem; background: #f9fafb; border-radius: 8px; text-decoration: none; color: #111; transition: all 0.2s; border: 2px solid transparent;';
                card.innerHTML = `
                    <div style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">${sub.label}</div>
                    <div style="color: #6b7280; font-size: 0.9rem;">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí</div>
                `;
                card.addEventListener('mouseenter', () => {
                    card.style.background = '#fff';
                    card.style.borderColor = '#4f46e5';
                    card.style.transform = 'translateY(-2px)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.background = '#f9fafb';
                    card.style.borderColor = 'transparent';
                    card.style.transform = 'translateY(0)';
                });
                subcategoryList.appendChild(card);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
        function showItemsView(category, subcategory) {
            currentCategory = category;
            currentSubcategory = subcategory;
            
            const categoryData = categories[category];
            const subcategoryData = subcategories[category].find(s => s.value === subcategory);
            
            document.getElementById('pageTitle').textContent = subcategoryData.label;
            document.getElementById('breadcrumbCategory').innerHTML = `
                <a href="?category=${category}" style="color: #4f46e5; text-decoration: none;">${categoryData.label}</a>
                <span style="margin: 0 8px;">/</span>
                <span>${subcategoryData.label}</span>
            `;
            
            document.getElementById('categoryView').style.display = 'none';
            document.getElementById('filtersSection').style.display = 'block';

            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
            const subcategoryFilter = document.getElementById('subcategoryFilter');
            subcategoryFilter.innerHTML = '<option value="">–í—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';
            subcategories[category].forEach(sub => {
                const option = document.createElement('option');
                option.value = sub.value;
                option.textContent = sub.label;
                if (sub.value === subcategory) option.selected = true;
                subcategoryFilter.appendChild(option);
            });

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
            filterAndDisplayItems();
        }

        // –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
        function filterAndDisplayItems() {
            let items = JSON.parse(localStorage.getItem('mockItems')) || [];

            if (currentCategory) {
                items = items.filter(item => item.category === currentCategory);
            }
            if (currentSubcategory) {
                items = items.filter(item => item.subcategory === currentSubcategory);
            }

            const priceFrom = document.getElementById('priceFrom').value;
            const priceTo = document.getElementById('priceTo').value;

            if (priceFrom) {
                items = items.filter(item => item.price >= Number(priceFrom));
            }
            if (priceTo) {
                items = items.filter(item => item.price <= Number(priceTo));
            }

            displayItems(items, 'allItems');
        }

        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
        document.getElementById('applyFilters').addEventListener('click', function() {
            const subcategorySelect = document.getElementById('subcategoryFilter');
            currentSubcategory = subcategorySelect.value || currentSubcategory;
            filterAndDisplayItems();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
            const subcategory = urlParams.get('subcategory');

            if (category && subcategory) {
                // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                showItemsView(category, subcategory);
            } else if (category) {
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                showCategoryView(category);
            } else {
                // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
                document.getElementById('pageTitle').textContent = '–í—Å–µ –≤–µ—â–∏';
                document.getElementById('filtersSection').style.display = 'none';
                const items = JSON.parse(localStorage.getItem('mockItems')) || [];
                displayItems(items, 'allItems');
            }

            // === CHAT FUNCTIONALITY ===
            let currentChatItem = null;

            // Open item detail modal
            window.openItemDetail = function(itemId) {
                const items = JSON.parse(localStorage.getItem('mockItems')) || [];
                const item = items.find(i => i.id === itemId);
                if (!item) return;

                currentChatItem = item;
                
                const modal = document.getElementById('itemDetailModal');
                const content = document.getElementById('itemDetailContent');
                
                let imagesHtml = '';
                if (item.images && item.images.length > 0) {
                    imagesHtml = `
                        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:0.5rem; margin-bottom:1.5rem;">
                            ${item.images.map(img => `<img src="${img}" style="width:100%; height:150px; object-fit:cover; border-radius:8px;">`).join('')}
                        </div>
                    `;
                }
                
                content.innerHTML = `
                    ${imagesHtml}
                    <h2 style="margin-bottom:1rem;">${item.name}</h2>
                    <p style="color:#6b7280; margin-bottom:1rem;">${item.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</p>
                    <div style="display:flex; gap:1rem; margin-bottom:1rem; flex-wrap:wrap;">
                        <div style="background:#f9fafb; padding:1rem; border-radius:8px; flex:1; min-width:150px;">
                            <div style="color:#6b7280; font-size:0.85rem;">–¶–µ–Ω–∞</div>
                            <div style="font-size:1.5rem; font-weight:bold; color:#4f46e5;">${item.price}‚Ç∏/–¥–µ–Ω—å</div>
                        </div>
                        <div style="background:#f9fafb; padding:1rem; border-radius:8px; flex:1; min-width:150px;">
                            <div style="color:#6b7280; font-size:0.85rem;">–í–ª–∞–¥–µ–ª–µ—Ü</div>
                            <div style="font-size:1.1rem; font-weight:600;">${item.ownerName || '–ê–Ω–æ–Ω–∏–º'}</div>
                        </div>
                    </div>
                `;
                
                modal.style.display = 'block';
            };

            // Close item detail modal
            document.getElementById('closeDetailModal').addEventListener('click', function() {
                document.getElementById('itemDetailModal').style.display = 'none';
            });

            // Open chat modal
            document.getElementById('contactOwnerBtn').addEventListener('click', function() {
                if (!currentChatItem) return;

                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                if (!currentUser) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü—É');
                    window.location.href = 'login.html';
                    return;
                }

                // Initialize chat
                document.getElementById('chatOwnerName').textContent = `–ß–∞—Ç —Å ${currentChatItem.ownerName || '–≤–ª–∞–¥–µ–ª—å—Ü–µ–º'}`;
                document.getElementById('chatItemName').textContent = currentChatItem.name;
                
                // Load messages
                loadChatMessages(currentChatItem.id);
                
                // Open chat modal
                document.getElementById('chatModal').style.display = 'block';
                document.getElementById('itemDetailModal').style.display = 'none';
            });

            // Close chat modal
            document.getElementById('closeChatModal').addEventListener('click', function() {
                document.getElementById('chatModal').style.display = 'none';
            });

            // Send message
            function sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                if (!message || !currentChatItem) return;

                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                if (!currentUser) return;

                // Get all chats from localStorage
                let chats = JSON.parse(localStorage.getItem('chats')) || {};
                const chatKey = `${currentChatItem.id}_${currentUser.phone}`;
                
                if (!chats[chatKey]) {
                    chats[chatKey] = {
                        itemId: currentChatItem.id,
                        itemName: currentChatItem.name,
                        ownerPhone: currentChatItem.ownerPhone,
                        renterPhone: currentUser.phone,
                        messages: []
                    };
                }

                // Add message
                chats[chatKey].messages.push({
                    sender: currentUser.phone,
                    senderName: currentUser.name,
                    message: message,
                    timestamp: new Date().toISOString()
                });

                // Save to localStorage
                localStorage.setItem('chats', JSON.stringify(chats));

                // Clear input
                input.value = '';

                // Reload messages
                loadChatMessages(currentChatItem.id);
            }

            // Load chat messages
            function loadChatMessages(itemId) {
                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                if (!currentUser) return;

                const chats = JSON.parse(localStorage.getItem('chats')) || {};
                const chatKey = `${itemId}_${currentUser.phone}`;
                const chat = chats[chatKey];

                const messagesContainer = document.getElementById('chatMessages');
                
                if (!chat || !chat.messages || chat.messages.length === 0) {
                    messagesContainer.innerHTML = `
                        <div style="text-align:center; color:#6b7280; padding:2rem;">
                            <i class="fas fa-comment-slash" style="font-size:3rem; margin-bottom:1rem; opacity:0.3;"></i>
                            <p>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º</p>
                        </div>
                    `;
                    return;
                }

                messagesContainer.innerHTML = chat.messages.map(msg => {
                    const isMyMessage = msg.sender === currentUser.phone;
                    return `
                        <div style="margin-bottom:1rem; display:flex; justify-content:${isMyMessage ? 'flex-end' : 'flex-start'};">
                            <div style="max-width:70%; background:${isMyMessage ? '#4f46e5' : '#fff'}; color:${isMyMessage ? '#fff' : '#111'}; padding:0.75rem 1rem; border-radius:12px; ${isMyMessage ? '' : 'border:1px solid #e5e7eb;'}">
                                <div style="font-weight:600; font-size:0.85rem; margin-bottom:0.25rem; opacity:0.8;">${msg.senderName}</div>
                                <div>${msg.message}</div>
                                <div style="font-size:0.75rem; margin-top:0.25rem; opacity:0.6;">${new Date(msg.timestamp).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}</div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            // Send message on button click
            document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);

            // Send message on Enter key
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Close modals on background click
            document.getElementById('itemDetailModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });

            document.getElementById('chatModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>

