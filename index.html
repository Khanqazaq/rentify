<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Rentify.kz - Аренда вещей между людьми в Казахстане | От 1000₸/день</title>
    <meta name="description" content="Rentify.kz — платформа аренды вещей между людьми в Казахстане. Камеры, ноутбуки, велосипеды, инструменты от 1000₸/день. Безопасные сделки в Алматы, Астане, Шымкенте.">
    <meta name="keywords" content="аренда вещей казахстан, прокат техники алматы, аренда камеры, аренда ноутбука, шеринг экономика">
    <meta name="author" content="Rentify Team">
    <link rel="canonical" href="https://rentify-ii2d.vercel.app/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rentify-ii2d.vercel.app/">
    <meta property="og:title" content="Rentify — аренда вещей между людьми в Казахстане">
    <meta property="og:description" content="Камеры, ноутбуки, велосипеды, инструменты от 1000₸/день. Безопасные сделки с проверкой.">
    <meta property="og:image" content="https://rentify-ii2d.vercel.app/images/og-preview.jpg">
    <meta property="og:site_name" content="Rentify.kz">
    <meta property="og:locale" content="ru_RU">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Rentify — аренда вещей между людьми">
    <meta name="twitter:description" content="Камеры, ноутбуки, велосипеды от 1000₸/день в Казахстане">
    <meta name="twitter:image" content="https://rentify-ii2d.vercel.app/images/twitter-preview.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- Preconnect для ускорения -->
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://images.unsplash.com" crossorigin>
    <link rel="dns-prefetch" href="https://firebaseio.com">
    
    <!-- Preload критических ресурсов -->
    <link rel="preload" href="css/style.css" as="style">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(self), payment=()">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com https://cdnjs.cloudflare.com https://apis.google.com https://www.googletagmanager.com;
        style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com;
        img-src 'self' https: data: blob: https://*.unsplash.com https://images.unsplash.com https://i.ibb.co;
        font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com;
        connect-src 'self' https://*.firebaseio.com https://*.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com wss://*.firebaseio.com https://api.unsplash.com;
        frame-src 'self' https://accounts.google.com https://rentify-kz.firebaseapp.com;
        object-src 'none';
        media-src 'self' https:;
        child-src 'self';
        worker-src 'self' blob:;
        manifest-src 'self';
        frame-ancestors 'none';
        base-uri 'self';
        form-action 'self';
        upgrade-insecure-requests;
    ">
    
    <!-- Firebase SDK с defer -->
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <!-- Schema.org Organization -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Rentify.kz",
        "url": "https://rentify.kz",
        "logo": "https://rentify.kz/images/logo.png",
        "description": "Платформа аренды вещей между людьми в Казахстане",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Алматы",
            "addressCountry": "KZ"
        },
        "sameAs": [
            "https://www.instagram.com/rentify.kz",
            "https://t.me/rentify_kz"
        ],
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "+7-700-123-45-67",
            "contactType": "Customer Service",
            "areaServed": "KZ",
            "availableLanguage": ["Russian", "Kazakh"]
        }
    }
    </script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <a href="index.html" class="logo">Rentify</a>
                
                <div class="nav-search">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Поиск вещей..." id="searchInput">
                </div>
                
                <div class="nav-menu">
                    <a href="items.html">Все вещи</a>
                    <a href="#" data-action="add-item">Добавить вещь</a>
                    <a href="login.html" class="btn-login" id="loginBtn">Войти</a>
                    <a href="login.html" class="btn-login" id="registerBtn">Регистрация</a>
                    <a href="profile.html" class="btn-login" id="profileBtn" style="display:none;">Профиль</a>
                    <div class="language-switcher">
                        <button class="lang-btn" data-lang="kk">🇰🇿</button>
                        <button class="lang-btn" data-lang="ru">🇷🇺</button>
                    </div>
                </div>
                
                <!-- Mobile language switcher (always visible) -->
                <div class="mobile-lang-switcher">
                    <button class="lang-btn" data-lang="kk" title="Қазақша">🇰🇿</button>
                    <button class="lang-btn" data-lang="ru" title="Русский">🇷🇺</button>
                </div>
                
                <button class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">
                    <span class="hero-title-main">Арендуй нужные вещи</span>
                    <span class="gradient-text">быстро и удобно</span>
                </h1>
                <p class="hero-description">
                    Когда вещи нужны на день, неделю или месяц — бери в аренду у людей рядом. Камеры, ноутбуки, инструменты, транспорт и многое другое. Проверенные пользователи. Безопасно. Выгодно.
                </p>
                <div class="hero-buttons">
                    <a href="items.html" class="btn btn-primary">Начать поиск</a>
                    <button class="btn btn-earn" data-action="add-item" id="earn-btn-2025">💰 Заработать на своей вещи</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Categories -->
    <section class="categories">
        <div class="container">
            <h2 class="section-title">Популярные категории</h2>
            <div class="categories-grid" id="categoriesContainer">
                <!-- Основные 6 категорий (всегда видны) -->
                <a href="items.html?category=electronics" class="category-card">
                    <picture>
                        <source srcset="./images/computer.webp" type="image/webp">
                        <img src="https://i.ibb.co/v4TPJcn4/Computer.png" alt="Электроника" width="80" height="80" loading="eager">
                    </picture>
                    <div class="category-name">Электроника</div>
                </a>
                <a href="items.html?category=clothing" class="category-card">
                    <picture>
                        <source srcset="./images/одежда.webp" type="image/webp">
                        <img src="./images/одежда.png" alt="Одежда" width="80" height="80" loading="eager">
                    </picture>
                    <div class="category-name">Одежда</div>
                </a>
                <a href="items.html?category=sports" class="category-card">
                    <picture>
                        <source srcset="./images/спорт.webp" type="image/webp">
                        <img src="./images/спорт-removebg-preview.png" alt="Спорт" width="80" height="80" loading="eager">
                    </picture>
                    <div class="category-name">Спорт</div>
                </a>
                <a href="items.html?category=auto" class="category-card">
                    <picture>
                        <source srcset="./images/авто.webp" type="image/webp">
                        <img src="./images/авто.jpg" alt="Авто" width="80" height="80" loading="eager">
                    </picture>
                    <div class="category-name">Авто</div>   
                </a>
                <a href="items.html?category=tools" class="category-card">
                    <picture>
                        <source srcset="./images/техника.webp" type="image/webp">
                        <img src="./images/техника.png" alt="Инструменты" width="80" height="80" loading="eager">
                    </picture>
                    <div class="category-name">Инструменты</div>
                </a>
                <a href="items.html?category=furniture" class="category-card">
                    <picture>
                        <source srcset="./images/мебель.webp" type="image/webp">
                        <img src="./images/мебель-removebg-preview (1).png" alt="Мебель" width="80" height="80" loading="eager">
                    </picture>
                    <div class="category-name">Мебель</div>
                </a>
                
                <!-- Остальные категории -->
                <a href="items.html?category=music" class="category-card">
                    <picture>
                        <source srcset="./images/музыка.webp" type="image/webp">
                        <img src="./images/Музыкальный инструмент.png" alt="Музыкальные инструменты - аренда гитар, пианино, синтезаторов" width="80" height="80" loading="lazy">
                    </picture>
                    <div class="category-name">Музыкальные инструменты</div>
                </a>
                <a href="items.html?category=camping" class="category-card">
                    <picture>
                        <source srcset="./images/туризм.webp" type="image/webp">
                        <img src="./images/туризм и кемпинг.jpg" alt="Туризм и кемпинг - аренда палаток, спальников, снаряжения" width="80" height="80" loading="lazy">
                    </picture>
                    <div class="category-name">Туризм и кемпинг</div>
                </a>
                <a href="items.html?category=kids" class="category-card">
                    <picture>
                        <source srcset="./images/детские.webp" type="image/webp">
                        <img src="./images/детских-товар.jpg" alt="Детские товары - аренда колясок, игрушек, детской мебели" width="80" height="80" loading="lazy">
                    </picture>
                    <div class="category-name">Детские товары</div>
                </a>
                <a href="items.html?category=events" class="category-card">
                    <img src="./images/для мероприятий.webp" alt="Для мероприятий - аренда звука, освещения, декора" width="80" height="80" loading="lazy">
                    <div class="category-name">Для мероприятий</div>
                </a>
                <a href="items.html?category=books" class="category-card">
                    <picture>
                        <source srcset="./images/книги.webp" type="image/webp">
                        <img src="./images/книги.jpg" alt="Книги - аренда учебников, художественной литературы" width="80" height="80" loading="lazy">
                    </picture>
                    <div class="category-name">Книги</div>
                </a>
            </div>
            

        </div>
    </section>

    <!-- Featured Items -->
    <section class="featured-items">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Рекомендуемые вещи</h2>
                <a href="items.html" class="view-all">Смотреть все →</a>
            </div>
            <div class="items-grid" id="featuredItems">
                <!-- Карточки как на скриншоте -->
                <div class="item-card">
                    <div class="item-header">
                        <div class="item-timer">0:0:24</div>
                        <div class="item-favorite">
                            <i class="far fa-heart"></i>
                        </div>
                    </div>
                    <div class="item-image-wrapper">
                        <img src="https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=300&h=200&fit=crop" alt="FIREBAT 16B Air 16" / 16.1 дюйма" class="item-image">
                        <div class="item-discount">3% Б</div>
                    </div>
                    <div class="item-details">
                        <h3 class="item-title">FIREBAT 16B Air 16" / 16.1…</h3>
                        <div class="item-rating">
                            <span class="rating-score">4.9</span>
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                            <span class="rating-count">5 отзывов</span>
                        </div>
                        <div class="item-pricing">
                            <div class="item-price">849 990 ₸</div>
                            <div class="item-installment">
                                <span class="installment-price">35 417 ₸</span>
                                <span class="installment-term">x24</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-header">
                        <div class="item-timer">0:0:24</div>
                        <div class="item-favorite">
                            <i class="far fa-heart"></i>
                        </div>
                    </div>
                    <div class="item-image-wrapper">
                        <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=300&h=200&fit=crop" alt="Apple MacBook Pro 16 2024" class="item-image" width="300" height="200" loading="lazy">
                        <div class="item-discount">3% Б</div>
                    </div>
                    <div class="item-details">
                        <h3 class="item-title">Apple MacBook Pro 16 202…</h3>
                        <div class="item-rating">
                            <span class="rating-score">4.8</span>
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                            <span class="rating-count">61 отзыв</span>
                        </div>
                        <div class="item-pricing">
                            <div class="item-price">689 171 ₸</div>
                            <div class="item-installment">
                                <span class="installment-price">28 716 ₸</span>
                                <span class="installment-term">x24</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-header">
                        <div class="item-timer">0:0:24</div>
                        <div class="item-favorite">
                            <i class="far fa-heart"></i>
                        </div>
                    </div>
                    <div class="item-image-wrapper">
                        <img src="https://images.unsplash.com/photo-1603302576837-37561b2e2302?w=300&h=200&fit=crop" alt="Acer Nitro 5 AN515-58 15.6\"" class="item-image" width="300" height="200" loading="lazy">
                        <div class="item-discount">-15%</div>
                    </div>
                    <div class="item-details">
                        <h3 class="item-title">Acer Nitro 5 AN515-58 15.6"…</h3>
                        <div class="item-rating">
                            <span class="rating-score">4.9</span>
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                            <span class="rating-count">40 отзывов</span>
                        </div>
                        <div class="item-pricing">
                            <div class="item-price-wrapper">
                                <div class="item-price">497 790 ₸</div>
                                <div class="item-old-price">589 900 ₸</div>
                            </div>
                            <div class="item-installment">
                                <span class="installment-price">20 742 ₸</span>
                                <span class="installment-term">x24</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="item-card">
                    <div class="item-header">
                        <div class="item-timer">0:0:24</div>
                        <div class="item-favorite">
                            <i class="far fa-heart"></i>
                        </div>
                    </div>
                    <div class="item-image-wrapper">
                        <img src="https://images.unsplash.com/photo-1525547719571-a2d4ac8945e2?w=300&h=200&fit=crop" alt="Lenovo Legion 9 18IAX10 18\"" class="item-image" width="300" height="200" loading="lazy">
                        <div class="item-discount">3% Б</div>
                    </div>
                    <div class="item-details">
                        <h3 class="item-title">Lenovo Legion 9 18IAX10 1…</h3>
                        <div class="item-pricing">
                            <div class="item-price">3 750 000 ₸</div>
                            <div class="item-installment">
                                <span class="installment-price">156 250 ₸</span>
                                <span class="installment-term">x24</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works -->
    <section class="how-it-works">
        <div class="container">
            <h2 class="section-title">Как это работает</h2>
            <div class="steps">
                <div class="step" data-step="1">
                    <div class="step-header">
                        <div class="step-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="step-title-wrapper">
                            <h3>Найдите нужную вещь</h3>
                            <i class="fas fa-chevron-down step-arrow"></i>
                        </div>
                    </div>
                    <p class="step-description">Ищите по категориям, фильтруйте по цене и местоположению</p>
                    <div class="step-details">
                        <p>Ищите по району, цене и рейтингу. Более 5000 вещей в Алматы, Астане и ещё 10+ городах.</p>
                    </div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-header">
                        <div class="step-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="step-title-wrapper">
                            <h3>Забронируйте и оплатите</h3>
                            <i class="fas fa-chevron-down step-arrow"></i>
                        </div>
                    </div>
                    <p class="step-description">Выберите даты аренды и безопасно оплатите через платформу</p>
                    <div class="step-details">
                        <p>Выбирайте даты → оплачивайте картой или через Kaspi → деньги замораживаются до получения вещи.</p>
                    </div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-header">
                        <div class="step-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="step-title-wrapper">
                            <h3>Получите вещь</h3>
                            <i class="fas fa-chevron-down step-arrow"></i>
                        </div>
                    </div>
                    <p class="step-description">Встретьтесь с владельцем и заберите вещь в назначенное время</p>
                    <div class="step-details">
                        <p>Встречайтесь с владельцем в удобном месте и времени. Без залога в 90% случаев.</p>
                    </div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-header">
                        <div class="step-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="step-title-wrapper">
                            <h3>Оставьте отзыв</h3>
                            <i class="fas fa-chevron-down step-arrow"></i>
                        </div>
                    </div>
                    <p class="step-description">Поделитесь своим опытом и помогите другим пользователям</p>
                    <div class="step-details">
                        <p>Поделитесь опытом за 10 секунд — помогите другим выбрать лучшие вещи и хозяев.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Security Section -->
    <section class="security-section" style="padding: 4rem 0; background: #f8fafc;">
        <div class="container">
            <h2 class="section-title">Безопасность превыше всего</h2>
            <ul class="security-list" style="max-width: 800px; margin: 0 auto; font-size: 1.1rem; line-height: 1.8;">
                <li>• Все пользователи проходят проверку по номеру телефона и удостоверению</li>
                <li>• Деньги замораживаются до получения вещи</li>
                <li>• В 90% случаев — аренда без залога</li>
                <li>• При порче вещи — решаем споры и компенсируем до 500 000 ₸</li>
            </ul>
        </div>
    </section>

    <!-- Testimonials -->
    <section class="testimonials">
        <div class="container">
            <h2 class="section-title">Отзывы наших клиентов</h2>
            <div class="testimonials-grid">
                <div class="testimonial">
                    <div class="testimonial-header">
                        <div class="testimonial-avatar" style="background: linear-gradient(135deg, #0ea5e9, #9333ea); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold;">А</div>
                        <div>
                            <div class="testimonial-name">Алексей Иванов</div>
                            <div class="testimonial-role">Арендодатель</div>
                        </div>
                    </div>
                    <div class="testimonial-rating">★★★★★</div>
                    <p class="testimonial-text">Отличная платформа! За месяц заработал на аренде своей камеры больше, чем потратил на покупку.</p>
                </div>
                <div class="testimonial">
                    <div class="testimonial-header">
                        <div class="testimonial-avatar" style="background: linear-gradient(135deg, #ec4899, #f59e0b); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold;">М</div>
                        <div>
                            <div class="testimonial-name">Мария Петрова</div>
                            <div class="testimonial-role">Арендатор</div>
                        </div>
                    </div>
                    <div class="testimonial-rating">★★★★★</div>
                    <p class="testimonial-text">Арендую велосипед каждые выходные. Намного дешевле, чем покупать свой!</p>
                </div>
            </div>
            <p style="text-align: center; margin-top: 2rem; font-size: 0.9rem; color: #6b7280;">
                Уже более 12 000 успешных аренд по Казахстану
            </p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-main">
                    <div class="footer-brand">
                        <h3 class="gradient-text">Rentify.kz</h3>
                        <p>Цифровая экосистема краткосрочной аренды — удобная платформа для безопасного обмена вещами между людьми.</p>
                        <div class="footer-social">
                            <a href="https://instagram.com/rentify.kz" class="social-link" aria-label="Instagram" target="_blank"><i class="fab fa-instagram"></i></a>
                            <a href="https://t.me/rentifykz" class="social-link" aria-label="Telegram" target="_blank"><i class="fab fa-telegram"></i></a>
                            <a href="https://wa.me/77472007077" class="social-link" aria-label="WhatsApp" target="_blank"><i class="fab fa-whatsapp"></i></a>
                            <a href="mailto:nadirkansabyr@gmail.com" class="social-link" aria-label="Email" target="_blank"><i class="fas fa-envelope"></i></a>
                        </div>
                    </div>
                    <div class="footer-links">
                        <div class="footer-column">
                            <h4>Компания</h4>
                            <a href="#" onclick="openInfoModal('about', event)">О нас</a>
                            <a href="#" onclick="openInfoModal('faq', event)">Частые вопросы</a>
                            <a href="#">Карьера</a>
                            <a href="#">Новости</a>
                        </div>
                        <div class="footer-column">
                            <h4>Поддержка</h4>
                            <a href="#">Центр помощи</a>
                            <a href="#">Безопасность</a>
                            <a href="#" onclick="openInfoModal('rules', event)">Правила</a>
                            <a href="#">Политика конфиденциальности</a>
                        </div>
                        <div class="footer-column">
                            <h4>Поддержка</h4>
                            <a href="mailto:nadirkhansabyr@gmail.com">nadirkhansabyr@gmail.com</a>
                            <a href="https://t.me/rentify_bot">Telegram: rentify_bot</a>
                            <a href="tel:+77472007077">Горячая линия: +7 (747) 200-70-77</a>
                        </div>
                        <div class="footer-column">
                            <h4>Помощь</h4>
                            <a href="#">• Как это работает</a>
                            <a href="#">• Правила аренды</a>
                            <a href="#">• Безопасность и страховка</a>
                            <a href="#">• Часто задаваемые вопросы</a>
                        </div>
                    </div>
                </div>
                
                <!-- Footer Bottom -->
                <div class="footer-bottom">
                    <div class="footer-copyright">
                        <p>Rentify.kz © 2025. Все права защищены.</p>
                        <p class="footer-legal">ТОО "Rentify" | БИН: 123456789012 | Лицензия НБ РК №5432</p>
                    </div>
                    <div class="footer-meta">
                        <a href="#">Карта сайта</a>
                        <span class="footer-divider">|</span>
                        <a href="#">Публичная оферта</a>
                        <span class="footer-divider">|</span>
                        <a href="#">Обработка данных</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Add listing modal -->
    <div id="add-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); align-items:center; justify-content:center; z-index:10000;">
        <div style="background:#fff; width:520px; border-radius:12px; padding:20px; box-shadow:0 20px 60px rgba(0,0,0,0.25);">
            <h2 style="margin-top:0; text-align:center;">Сдать вещь в аренду</h2>
            <div style="margin-bottom:8px;">
                <label style="display:block; font-weight:600; margin-bottom:6px;">Название вещи</label>
                <input id="item-title" type="text" placeholder="Например: Портативный проектор" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb;">
            </div>
            <div style="margin-bottom:8px;">
                <label style="display:block; font-weight:600; margin-bottom:6px;">Описание</label>
                <textarea id="item-desc" placeholder="Кратко опишите состояние и особенности" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb; height:90px;"></textarea>
            </div>
            <div style="display:flex; gap:8px; margin-bottom:8px;">
                <div style="flex:1;">
                    <label style="display:block; font-weight:600; margin-bottom:6px;">Категория</label>
                    <select id="item-category" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb;">
                        <option value="">Выберите категорию</option>
                        <option value="electronics">Электроника</option>
                        <option value="clothing">Одежда</option>
                        <option value="sports">Спорт</option>
                        <option value="auto">Авто</option>
                        <option value="tools">Инструменты</option>
                        <option value="furniture">Мебель</option>
                        <option value="music">Музыкальные инструменты</option>
                        <option value="camping">Туризм и кемпинг</option>
                        <option value="kids">Детские товары</option>
                        <option value="events">Для мероприятий</option>
                        <option value="books">Книги</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <label style="display:block; font-weight:600; margin-bottom:6px;">Подкатегория</label>
                    <select id="item-subcategory" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb;" disabled>
                        <option value="">Сначала выберите категорию</option>
                    </select>
                </div>
            </div>
            <div style="display:flex; gap:8px; margin-bottom:8px;">
                <div style="flex:1;">
                    <label style="display:block; font-weight:600; margin-bottom:6px;">Цена (в тенге / сутки)</label>
                    <input id="item-price" type="number" min="0" placeholder="1000" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb;">
                </div>
                <div style="flex:1;">
                    <label style="display:block; font-weight:600; margin-bottom:6px;">Телефон</label>
                    <input id="item-phone" type="tel" placeholder="7011234567" maxlength="10" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb;" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
                </div>
            </div>
            <div style="margin-bottom:8px;">
                <label style="display:block; font-weight:600; margin-bottom:6px;">Адрес / Город</label>
                <input id="item-address" type="text" placeholder="Город, улица, район" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb;">
            </div>
            <div style="margin-bottom:8px;">
                <label style="display:block; font-weight:600; margin-bottom:6px;">Фотографии (1 до 5 штук)</label>
                <input id="item-images" type="file" accept="image/*" multiple style="display:none;">
                <button type="button" onclick="document.getElementById('item-images').click()" style="width:100%; padding:12px; border-radius:8px; background:#f3f4f6; border:2px dashed #d1d5db; cursor:pointer; color:#6b7280; font-weight:600; transition: all 0.2s;">
                    📷 Выбрать фото с устройства
                </button>
                <div id="preview-container" style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;"></div>
                <small style="color:#6b7280; display:block; margin-top:6px;">Загрузите от 1 до 5 качественных фото — они помогут быстрее привлечь внимание арендаторов.</small>
            </div>
            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
                <button id="add-cancel" style="padding:10px 14px; border-radius:8px; background:#f3f4f6; border:none; cursor:pointer;">Отмена</button>
                <button id="add-save" style="padding:10px 14px; border-radius:8px; background:#4f46e5; color:#fff; border:none; cursor:pointer;">Опубликовать</button>
            </div>
        </div>
    </div>

    <!-- Item Detail Modal -->
    <div id="itemDetailModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; overflow-y:auto;">
        <div style="max-width:800px; margin:2rem auto; background:white; border-radius:12px; position:relative; padding:2rem;">
            <button id="closeDetailModal" style="position:absolute; top:1rem; right:1rem; background:none; border:none; font-size:2rem; cursor:pointer; color:#999;">&times;</button>
            <div id="itemDetailContent">
                <!-- Content will be loaded by JS -->
            </div>
            <button id="contactOwnerBtn" class="btn btn-primary" style="width:100%; margin-top:1.5rem; padding:1rem; font-size:1.1rem;">
                <i class="fas fa-comment-dots"></i> Написать владельцу
            </button>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1001;">
        <div style="max-width:500px; margin:2rem auto; background:white; border-radius:12px; position:relative; height:600px; display:flex; flex-direction:column;">
            <!-- Chat Header -->
            <div style="padding:1rem; border-bottom:1px solid #e5e7eb; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h3 id="chatOwnerName" style="margin:0; font-size:1.1rem;">Чат с владельцем</h3>
                    <p id="chatItemName" style="margin:0.25rem 0 0 0; font-size:0.85rem; color:#6b7280;"></p>
                </div>
                <button id="closeChatModal" style="background:none; border:none; font-size:2rem; cursor:pointer; color:#999;">&times;</button>
            </div>

            <!-- Chat Messages -->
            <div id="chatMessages" style="flex:1; padding:1rem; overflow-y:auto; background:#f9fafb;">
                <!-- Messages will be loaded here -->
            </div>

            <!-- Chat Input -->
            <div style="padding:1rem; border-top:1px solid #e5e7eb; background:white;">
                <div style="display:flex; gap:0.5rem;">
                    <input type="text" id="chatInput" placeholder="Введите сообщение..." style="flex:1; padding:0.75rem; border:1px solid #e5e7eb; border-radius:8px;">
                    <button id="sendMessageBtn" class="btn btn-primary" style="padding:0.75rem 1.5rem;">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- All Messages Modal -->
    <div id="messagesModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1001;">
        <div style="max-width:700px; margin:2rem auto; background:white; border-radius:12px; position:relative; height:80vh; display:flex; flex-direction:column;">
            <!-- Header -->
            <div style="padding:1.5rem; border-bottom:1px solid #e5e7eb; display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0; font-size:1.3rem;">Все сообщения</h3>
                <button id="closeMessagesModal" style="background:none; border:none; font-size:2rem; cursor:pointer; color:#999;">&times;</button>
            </div>

            <!-- Chats List -->
            <div id="chatsList" style="flex:1; overflow-y:auto; padding:1rem;">
                <!-- Chats will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Info Modal (About, Rules, Contacts, FAQ, Partnership) -->
    <div id="infoModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:2000; overflow-y:auto;">
        <div style="max-width:700px; margin:3rem auto; background:white; border-radius:12px; position:relative; padding:2.5rem;">
            <button id="closeInfoModal" style="position:absolute; top:1rem; right:1rem; background:none; border:none; font-size:2rem; cursor:pointer; color:#999;">&times;</button>
            <div id="infoModalContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script src="js/sanitizer.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-db.js"></script>
    <script src="js/notifications.js"></script>
    <script src="./js/main.js"></script>
    <script src="js/language.js"></script>
    <script src="js/event-handlers.js"></script>
    <script>
        // Add listing modal logic with image upload (up to 5 images)
        (function(){
            // Структура подкатегорий (та же что в items.html)
            const subcategories = {
                electronics: [
                    { value: 'phones', label: 'Телефоны' },
                    { value: 'computers', label: 'Компьютеры' },
                    { value: 'cameras', label: 'Камеры' },
                    { value: 'audio', label: 'Аудио' },
                    { value: 'tv', label: 'ТВ и видео' }
                ],
                clothing: [
                    { value: 'men', label: 'Мужская' },
                    { value: 'women', label: 'Женская' },
                    { value: 'kids', label: 'Детская' },
                    { value: 'accessories', label: 'Аксессуары' }
                ],
                sports: [
                    { value: 'fitness', label: 'Фитнес' },
                    { value: 'bicycles', label: 'Велосипеды' },
                    { value: 'winter', label: 'Зимний спорт' },
                    { value: 'water', label: 'Водный спорт' },
                    { value: 'camping', label: 'Туризм' }
                ],
                auto: [
                    { value: 'cars', label: 'Автомобили' },
                    { value: 'motorcycles', label: 'Мотоциклы' },
                    { value: 'scooters', label: 'Скутеры' },
                    { value: 'accessories', label: 'Автоаксессуары' }
                ],
                tools: [
                    { value: 'power', label: 'Электроинструмент' },
                    { value: 'hand', label: 'Ручной инструмент' },
                    { value: 'garden', label: 'Садовая техника' },
                    { value: 'construction', label: 'Строительное оборудование' }
                ],
                furniture: [
                    { value: 'living', label: 'Гостиная' },
                    { value: 'bedroom', label: 'Спальня' },
                    { value: 'office', label: 'Офисная' },
                    { value: 'outdoor', label: 'Уличная' }
                ],
                music: [
                    { value: 'string', label: 'Струнные' },
                    { value: 'keyboard', label: 'Клавишные' },
                    { value: 'percussion', label: 'Ударные' },
                    { value: 'wind', label: 'Духовые' },
                    { value: 'dj', label: 'DJ-оборудование' },
                    { value: 'studio', label: 'Студийное оборудование' }
                ],
                camping: [
                    { value: 'tents', label: 'Палатки' },
                    { value: 'sleeping', label: 'Спальники и коврики' },
                    { value: 'backpacks', label: 'Рюкзаки' },
                    { value: 'cooking', label: 'Походная посуда' },
                    { value: 'equipment', label: 'Туристическое снаряжение' }
                ],
                kids: [
                    { value: 'strollers', label: 'Коляски' },
                    { value: 'carseats', label: 'Автокресла' },
                    { value: 'toys', label: 'Игрушки' },
                    { value: 'furniture', label: 'Детская мебель' },
                    { value: 'clothes', label: 'Детская одежда' }
                ],
                events: [
                    { value: 'decorations', label: 'Декорации' },
                    { value: 'sound', label: 'Звуковое оборудование' },
                    { value: 'lighting', label: 'Световое оборудование' },
                    { value: 'costumes', label: 'Костюмы' },
                    { value: 'photo', label: 'Фотозоны' }
                ],
                books: [
                    { value: 'fiction', label: 'Художественная литература' },
                    { value: 'education', label: 'Образовательная литература' },
                    { value: 'business', label: 'Бизнес и саморазвитие' },
                    { value: 'children', label: 'Детская литература' },
                    { value: 'rare', label: 'Редкие издания' }
                ]
            };

            const overlay = document.getElementById('add-overlay');
            const categorySelect = document.getElementById('item-category');
            const subcategorySelect = document.getElementById('item-subcategory');
            const imageInput = document.getElementById('item-images');
            const previewContainer = document.getElementById('preview-container');
            let selectedImages = [];

            // Обработка выбора файлов
            imageInput.addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                
                if (files.length + selectedImages.length > 5) {
                    alert('Максимум 5 изображений');
                    return;
                }

                files.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            selectedImages.push(event.target.result);
                            renderPreviews();
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });

            // Отображение превью
            function renderPreviews() {
                previewContainer.innerHTML = '';
                selectedImages.forEach((src, index) => {
                    const box = document.createElement('div');
                    box.style.cssText = 'position:relative; width:80px; height:80px; border-radius:8px; overflow:hidden; border:2px solid #e5e7eb;';
                    
                    const img = document.createElement('img');
                    img.src = src;
                    img.style.cssText = 'width:100%; height:100%; object-fit:cover;';
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.innerHTML = '✕';
                    removeBtn.style.cssText = 'position:absolute; top:4px; right:4px; width:20px; height:20px; border-radius:50%; background:#ef4444; color:#fff; border:none; cursor:pointer; font-size:12px; line-height:1;';
                    removeBtn.onclick = function() {
                        selectedImages.splice(index, 1);
                        renderPreviews();
                    };
                    
                    box.appendChild(img);
                    box.appendChild(removeBtn);
                    previewContainer.appendChild(box);
                });
            }

            // Обработчик выбора категории
            categorySelect.addEventListener('change', function() {
                const selectedCategory = this.value;
                
                if (selectedCategory && subcategories[selectedCategory]) {
                    subcategorySelect.disabled = false;
                    subcategorySelect.innerHTML = '<option value="">Выберите подкатегорию</option>';
                    
                    subcategories[selectedCategory].forEach(sub => {
                        const option = document.createElement('option');
                        option.value = sub.value;
                        option.textContent = sub.label;
                        subcategorySelect.appendChild(option);
                    });
                } else {
                    subcategorySelect.disabled = true;
                    subcategorySelect.innerHTML = '<option value="">Сначала выберите категорию</option>';
                }
            });

            window.openAddModal = function(e){ if(e) e.preventDefault(); overlay.style.display='flex';
                // prefill address from saved location if available
                try{ const s = localStorage.getItem('user_location'); if(s){ const obj = JSON.parse(s); const addr = obj.city || obj.address || ''; if(addr) document.getElementById('item-address').value = addr; } }catch(e){}
            };

            window.openAddModalOrLogin = function(e) {
                e.preventDefault();
                const currentUser = sessionStorage.getItem('currentUser');
                if (!currentUser) {
                    window.location.href = 'login.html';
                } else {
                    openAddModal(e);
                }
            };

            const cancel = document.getElementById('add-cancel');
            const save = document.getElementById('add-save');

            cancel && cancel.addEventListener('click', ()=>{ 
                overlay.style.display='none'; 
                selectedImages = []; 
                previewContainer.innerHTML = '';
                imageInput.value = '';
            });

            save && save.addEventListener('click', ()=>{
                const title = (document.getElementById('item-title')||{}).value.trim();
                const desc = (document.getElementById('item-desc')||{}).value.trim();
                const category = (document.getElementById('item-category')||{}).value.trim();
                const subcategory = (document.getElementById('item-subcategory')||{}).value.trim();
                const price = (document.getElementById('item-price')||{}).value.trim();
                const phone = (document.getElementById('item-phone')||{}).value.trim();
                const address = (document.getElementById('item-address')||{}).value.trim();

                if(!title){ alert('Введите название вещи'); document.getElementById('item-title').focus(); return; }
                if(!desc){ alert('Введите описание'); document.getElementById('item-desc').focus(); return; }
                if(!category){ alert('Выберите категорию'); document.getElementById('item-category').focus(); return; }
                if(!subcategory){ alert('Выберите подкатегорию'); document.getElementById('item-subcategory').focus(); return; }
                if(!price || isNaN(price) || Number(price) <= 0){ alert('Введите корректную цену'); document.getElementById('item-price').focus(); return; }
                if(!/^\d{10}$/.test(phone)){ alert('Введите корректный 10-значный номер телефона'); document.getElementById('item-phone').focus(); return; }
                if(!address){ alert('Введите адрес или город'); document.getElementById('item-address').focus(); return; }
                if(selectedImages.length === 0){ alert('Добавьте хотя бы одно фото'); return; }

                const images = selectedImages.slice(0,5);

                // Get current user info
                const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');

                const listing = {
                    id: 'l_' + Date.now(),
                    name: title,
                    title, 
                    description: desc,
                    desc, 
                    category, 
                    subcategory, 
                    price: Number(price), 
                    ownerPhone: '+7' + phone.replace(/\D/g,''), 
                    phone: '+7' + phone.replace(/\D/g,''),
                    ownerName: currentUser.name || 'Аноним',
                    city: address,
                    address,
                    images, 
                    created: Date.now(),
                    rating: 5.0,
                    reviews: 0
                };

                try{
                    // Save to mockItems for compatibility
                    const mockItems = JSON.parse(localStorage.getItem('mockItems')) || [];
                    mockItems.unshift(listing);
                    localStorage.setItem('mockItems', JSON.stringify(mockItems));
                    
                    // Also save to listings
                    const raw = localStorage.getItem('listings');
                    const arr = raw ? JSON.parse(raw) : [];
                    arr.unshift(listing);
                    localStorage.setItem('listings', JSON.stringify(arr));
                }catch(e){ alert('Ошибка при сохранении.'); console.error(e); return; }

                // Show success notification
                if (typeof showNotification === 'function') {
                    showNotification('Ваша вещь успешно опубликована!', 'success');
                } else {
                    alert('Ваша вещь опубликована!');
                }
                
                overlay.style.display='none';
                selectedImages = []; 
                previewContainer.innerHTML = '';
                imageInput.value = '';
                document.getElementById('item-title').value = '';
                document.getElementById('item-desc').value = '';
                document.getElementById('item-category').value = '';
                document.getElementById('item-subcategory').value = '';
                document.getElementById('item-price').value = '';
                document.getElementById('item-phone').value = '';
                window.location.href = 'items.html';
            });
        })();

        // === ALL MESSAGES MODAL ===
        window.openMessagesModal = function(e) {
            if (e) e.preventDefault();
            
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            if (!currentUser) {
                if (typeof showNotification === 'function') {
                    showNotification('Войдите в систему для просмотра сообщений', 'warning');
                }
                window.location.href = 'login.html';
                return;
            }

            loadAllChats();
            document.getElementById('messagesModal').style.display = 'block';
        };

        function loadAllChats() {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            const chats = JSON.parse(localStorage.getItem('chats') || '{}');
            const readMessages = JSON.parse(localStorage.getItem('readMessages') || '{}');
            const chatsList = document.getElementById('chatsList');

            const userChats = Object.keys(chats).filter(key => {
                const chat = chats[key];
                return chat.renterPhone === currentUser.phone || chat.ownerPhone === currentUser.phone;
            });

            if (userChats.length === 0) {
                chatsList.innerHTML = `
                    <div style="text-align:center; padding:3rem; color:#6b7280;">
                        <i class="fas fa-inbox" style="font-size:4rem; margin-bottom:1rem; opacity:0.3;"></i>
                        <p style="font-size:1.1rem;">У вас пока нет сообщений</p>
                    </div>
                `;
                return;
            }

            chatsList.innerHTML = userChats.map(chatKey => {
                const chat = chats[chatKey];
                const lastMessage = chat.messages && chat.messages.length > 0 
                    ? chat.messages[chat.messages.length - 1] 
                    : null;
                
                const lastReadIndex = readMessages[chatKey] || -1;
                const unreadCount = chat.messages 
                    ? chat.messages.filter((msg, index) => 
                        index > lastReadIndex && msg.sender !== currentUser.phone
                      ).length 
                    : 0;

                return `
                    <div onclick="openChatFromList('${chatKey}')" style="padding:1rem; border-bottom:1px solid #e5e7eb; cursor:pointer; transition:background 0.2s; display:flex; justify-content:space-between; align-items:center;" onmouseenter="this.style.background='#f9fafb'" onmouseleave="this.style.background='white'">
                        <div style="flex:1;">
                            <div style="font-weight:600; margin-bottom:0.25rem; display:flex; align-items:center; gap:0.5rem;">
                                ${chat.itemName}
                                ${unreadCount > 0 ? `<span style="background:#ef4444; color:white; font-size:11px; padding:2px 6px; border-radius:10px;">${unreadCount}</span>` : ''}
                            </div>
                            <div style="color:#6b7280; font-size:0.9rem;">
                                ${lastMessage ? lastMessage.message.substring(0, 50) + (lastMessage.message.length > 50 ? '...' : '') : 'Нет сообщений'}
                            </div>
                        </div>
                        <div style="color:#9ca3af; font-size:0.85rem;">
                            ${lastMessage ? new Date(lastMessage.timestamp).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'}) : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.openChatFromList = function(chatKey) {
            const chats = JSON.parse(localStorage.getItem('chats') || '{}');
            const chat = chats[chatKey];
            
            if (!chat) return;

            // Get item
            const items = JSON.parse(localStorage.getItem('mockItems')) || [];
            const item = items.find(i => i.id === chat.itemId);
            
            if (item && typeof openItemDetail === 'function') {
                document.getElementById('messagesModal').style.display = 'none';
                openItemDetail(item.id);
                setTimeout(() => {
                    document.getElementById('contactOwnerBtn').click();
                }, 100);
            }
        };

        document.getElementById('closeMessagesModal')?.addEventListener('click', function() {
            document.getElementById('messagesModal').style.display = 'none';
        });

        // === CHAT FUNCTIONALITY FOR INDEX.HTML ===
        (function(){
            let currentChatItem = null;

            // Open item detail modal
            window.openItemDetail = function(itemId) {
                const items = JSON.parse(localStorage.getItem('mockItems')) || [];
                const item = items.find(i => i.id === itemId);
                if (!item) return;

                currentChatItem = item;
                
                const modal = document.getElementById('itemDetailModal');
                const content = document.getElementById('itemDetailContent');
                
                let imagesHtml = '';
                if (item.images && item.images.length > 0) {
                    imagesHtml = `
                        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:0.5rem; margin-bottom:1.5rem;">
                            ${item.images.map(img => `<img src="${img}" style="width:100%; height:150px; object-fit:cover; border-radius:8px;">`).join('')}
                        </div>
                    `;
                } else if (item.image) {
                    imagesHtml = `<img src="${item.image}" style="width:100%; height:300px; object-fit:cover; border-radius:8px; margin-bottom:1.5rem;">`;
                }
                
                content.innerHTML = `
                    ${imagesHtml}
                    <h2 style="margin-bottom:1rem;">${item.name || item.title}</h2>
                    <p style="color:#6b7280; margin-bottom:1rem;">${item.description || item.desc || 'Описание отсутствует'}</p>
                    <div style="display:flex; gap:1rem; margin-bottom:1rem; flex-wrap:wrap;">
                        <div style="background:#f9fafb; padding:1rem; border-radius:8px; flex:1; min-width:150px;">
                            <div style="color:#6b7280; font-size:0.85rem;">Цена</div>
                            <div style="font-size:1.5rem; font-weight:bold; color:#4f46e5;">${item.price}₸/день</div>
                        </div>
                        <div style="background:#f9fafb; padding:1rem; border-radius:8px; flex:1; min-width:150px;">
                            <div style="color:#6b7280; font-size:0.85rem;">Владелец</div>
                            <div style="font-size:1.1rem; font-weight:600;">${item.ownerName || 'Аноним'}</div>
                        </div>
                    </div>
                `;
                
                modal.style.display = 'block';
            };

            // Close item detail modal
            const closeBtn = document.getElementById('closeDetailModal');
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    document.getElementById('itemDetailModal').style.display = 'none';
                });
            }

            // Open chat modal
            const contactBtn = document.getElementById('contactOwnerBtn');
            if (contactBtn) {
                contactBtn.addEventListener('click', function() {
                    if (!currentChatItem) return;

                    const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                    if (!currentUser) {
                        alert('Пожалуйста, войдите в систему чтобы написать владельцу');
                        window.location.href = 'login.html';
                        return;
                    }

                    // Initialize chat
                    document.getElementById('chatOwnerName').textContent = `Чат с ${currentChatItem.ownerName || 'владельцем'}`;
                    document.getElementById('chatItemName').textContent = currentChatItem.name || currentChatItem.title;
                    
                    // Load messages
                    loadChatMessages(currentChatItem.id);
                    
                    // Open chat modal
                    document.getElementById('chatModal').style.display = 'block';
                    document.getElementById('itemDetailModal').style.display = 'none';
                });
            }

            // Close chat modal
            const closeChatBtn = document.getElementById('closeChatModal');
            if (closeChatBtn) {
                closeChatBtn.addEventListener('click', function() {
                    document.getElementById('chatModal').style.display = 'none';
                });
            }

            // Send message
            function sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                if (!message || !currentChatItem) return;

                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                if (!currentUser) return;

                // Get all chats from localStorage
                let chats = JSON.parse(localStorage.getItem('chats')) || {};
                const chatKey = `${currentChatItem.id}_${currentUser.phone}`;
                
                if (!chats[chatKey]) {
                    chats[chatKey] = {
                        itemId: currentChatItem.id,
                        itemName: currentChatItem.name || currentChatItem.title,
                        ownerPhone: currentChatItem.ownerPhone || currentChatItem.phone,
                        renterPhone: currentUser.phone,
                        messages: []
                    };
                }

                // Add message
                chats[chatKey].messages.push({
                    sender: currentUser.phone,
                    senderName: currentUser.name,
                    message: message,
                    timestamp: new Date().toISOString()
                });

                // Save to localStorage
                localStorage.setItem('chats', JSON.stringify(chats));

                // Show notification
                if (typeof showNotification === 'function') {
                    showNotification('Сообщение отправлено', 'success', 2000);
                }

                // Clear input
                input.value = '';

                // Reload messages
                loadChatMessages(currentChatItem.id);
                
                // Update message badge
                if (typeof updateMessageBadge === 'function') {
                    updateMessageBadge(getUnreadMessagesCount());
                }
            }

            // Load chat messages
            function loadChatMessages(itemId) {
                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                if (!currentUser) return;

                const chats = JSON.parse(localStorage.getItem('chats')) || {};
                const chatKey = `${itemId}_${currentUser.phone}`;
                const chat = chats[chatKey];

                const messagesContainer = document.getElementById('chatMessages');
                
                if (!chat || !chat.messages || chat.messages.length === 0) {
                    messagesContainer.innerHTML = `
                        <div style="text-align:center; color:#6b7280; padding:2rem;">
                            <i class="fas fa-comment-slash" style="font-size:3rem; margin-bottom:1rem; opacity:0.3;"></i>
                            <p>Начните общение с владельцем</p>
                        </div>
                    `;
                    return;
                }

                messagesContainer.innerHTML = chat.messages.map(msg => {
                    const isMyMessage = msg.sender === currentUser.phone;
                    return `
                        <div style="margin-bottom:1rem; display:flex; justify-content:${isMyMessage ? 'flex-end' : 'flex-start'};">
                            <div style="max-width:70%; background:${isMyMessage ? '#4f46e5' : '#fff'}; color:${isMyMessage ? '#fff' : '#111'}; padding:0.75rem 1rem; border-radius:12px; ${isMyMessage ? '' : 'border:1px solid #e5e7eb;'}">
                                <div style="font-weight:600; font-size:0.85rem; margin-bottom:0.25rem; opacity:0.8;">${msg.senderName}</div>
                                <div>${msg.message}</div>
                                <div style="font-size:0.75rem; margin-top:0.25rem; opacity:0.6;">${new Date(msg.timestamp).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}</div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            // Send message on button click
            const sendBtn = document.getElementById('sendMessageBtn');
            if (sendBtn) {
                sendBtn.addEventListener('click', sendMessage);
            }

            // Send message on Enter key
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }

            // Close modals on background click
            const itemModal = document.getElementById('itemDetailModal');
            if (itemModal) {
                itemModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            }

            const chatModal = document.getElementById('chatModal');
            if (chatModal) {
                chatModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            }
        })();

        // Info Modal functionality
        const infoContent = {
            about: {
                title: 'О нас',
                text: `<strong>Rentify.kz — цифровая экосистема краткосрочной аренды</strong><br><br>
                
                Мы создали платформу, где каждый может легко сдать в аренду неиспользуемые вещи или найти нужный товар на короткий срок. Это экономно, экологично и удобно!<br><br>
                
                <strong>🎯 Наша миссия:</strong><br>
                Сделать мир более рациональным через sharing economy. Зачем покупать дорогую вещь для разового использования, если можно взять в аренду?<br><br>
                
                <strong>📈 Наши достижения:</strong><br>
                • 5,000+ успешных арендных сделок<br>
                • 98% довольных клиентов<br>
                • Средняя экономия 70% от стоимости покупки<br>
                • Работаем в 15+ городах Казахстана<br><br>
                
                <strong>👥 Команда:</strong><br>
                Мы — молодая IT-команда из Алматы, которая верит в силу технологий для решения повседневных задач.<br><br>
                
                <strong>🔮 Будущее:</strong><br>
                Планируем стать #1 платформой sharing economy в Центральной Азии к 2026 году.`
            },
            rules: {
                title: 'Правила платформы',
                text: `<strong>📋 Основные правила для всех пользователей</strong><br><br>
                
                <strong>🔒 Безопасность превыше всего:</strong><br>
                • Встречайтесь только в людных местах<br>
                • Проверяйте документы при передаче ценных вещей<br>
                • Фотографируйте состояние товара до и после аренды<br>
                • Не передавайте личные данные третьим лицам<br><br>
                
                <strong>💰 Честная оплата:</strong><br>
                • Оплата только после осмотра товара<br>
                • Возврат залога при возврате вещи в целости<br>
                • Никаких скрытых комиссий<br><br>
                
                <strong>⚖️ Права арендодателя:</strong><br>
                • Проверить документы арендатора<br>
                • Потребовать залог (до 50% стоимости товара)<br>
                • Отказать в аренде без объяснения причин<br>
                • Досрочно расторгнуть договор при нарушениях<br><br>
                
                <strong>✅ Права арендатора:</strong><br>
                • Получить товар в рабочем состоянии<br>
                • Бесплатную замену при поломке не по своей вине<br>
                • Полный возврат при отмене за 24 часа<br>
                • Поддержку службы 24/7<br><br>
                
                <strong>🚫 Запрещено на платформе:</strong><br>
                • Мошенничество и обман<br>
                • Аренда нелегальных товаров<br>
                • Подача ложной информации<br>
                • Нарушение авторских прав<br><br>
                
                <strong>⚠️ Ответственность:</strong><br>
                Пользователи несут полную ответственность за свои действия. Rentify.kz выступает только посредником.`
            },
            contacts: {
                title: 'Контакты и поддержка',
                text: `<strong>📞 Мы всегда на связи!</strong><br><br>
                
                <strong>🏢 Главный офис:</strong><br>
                📍 г. Алматы, мкр. Коктем-1, 1А<br>
                🏢 Бизнес-центр "IT Park"<br>
                🕒 Пн-Пт: 9:00-18:00<br><br>
                
                <strong>📱 Контакты:</strong><br>
                ☎️ Горячая линия: +7 (747) 200-70-77<br>
                📧 Email: nadirkansabyr@gmail.com<br>
                💬 Поддержка: nadirkansabyr@gmail.com<br>
                🤝 Партнерство: nadirkansabyr@gmail.com<br><br>
                
                <strong>🌐 Социальные сети:</strong><br>
                📸 Instagram: @rentify.kz<br>
                📱 Telegram: @rentifykz<br>
                💚 WhatsApp: +7 (747) 200-70-77<br><br>
                
                <strong>⏰ Время работы поддержки:</strong><br>
                🌟 Онлайн-чат: 24/7<br>
                📞 Телефон: 8:00-22:00<br>
                📧 Email: до 2 часов в рабочее время<br><br>
                
                <strong>🚨 Экстренные ситуации:</strong><br>
                В случае споров, мошенничества или чрезвычайных ситуаций звоните на горячую линию — мы поможем решить любой вопрос!`
            },
            faq: {
                title: 'Частые вопросы',
                text: `<strong>❓ Ответы на самые популярные вопросы</strong><br><br>
                
                <strong>Q: Как начать пользоваться Rentify?</strong><br>
                A: Зарегистрируйтесь через Google, заполните профиль и можете сразу искать вещи или размещать свои объявления!<br><br>
                
                <strong>Q: Сколько стоят услуги платформы?</strong><br>
                A: Для пользователей платформа бесплатна! Мы зарабатываем на премиум-услугах и рекламе.<br><br>
                
                <strong>Q: Что делать, если товар сломался?</strong><br>
                A: Сразу свяжитесь с владельцем и поддержкой. Если поломка не по вашей вине — ремонт за счет арендодателя.<br><br>
                
                <strong>Q: Можно ли оплачивать картой?</strong><br>
                A: Пока только наличными при встрече. Онлайн-платежи запустим в 2025 году!<br><br>
                
                <strong>Q: Как защититься от мошенников?</strong><br>
                A: Встречайтесь в людных местах, проверяйте документы, фотографируйте товар. У нас есть система рейтингов!<br><br>
                
                <strong>Q: Что можно сдавать в аренду?</strong><br>
                A: Всё легальное: инструменты, техника, спорттовары, одежда, автомобили, недвижимость.<br><br>
                
                <strong>Q: Сколько можно заработать?</strong><br>
                A: Зависит от товара. Например: дрель — 2,000₸/день, велосипед — 3,000₸/день, авто — 15,000₸/день.<br><br>
                
                <strong>Q: Работаете ли вы в моем городе?</strong><br>
                A: Мы работаем по всему Казахстану! Основные города: Алматы, Нур-Султан, Шымкент, Актобе.<br><br>
                
                <strong>💡 Есть еще вопросы?</strong><br>
                Напишите нам в чат или на nadirkansabyr@gmail.com — ответим в течение часа!`
            },
            partnership: {
                title: 'Партнерство и сотрудничество',
                text: `<strong>🤝 Давайте развиваться вместе!</strong><br><br>
                
                <strong>🎯 Кто может стать партнером:</strong><br>
                • Магазины и торговые сети<br>
                • Сервисные центры<br>
                • Страховые компании<br>
                • Логистические компании<br>
                • IT-разработчики<br>
                • Маркетинговые агентства<br><br>
                
                <strong>💰 Виды сотрудничества:</strong><br><br>
                
                <strong>🏪 Корпоративное партнерство:</strong><br>
                • Размещение товаров вашей компании<br>
                • Специальные условия и тарифы<br>
                • Интеграция с вашими системами<br>
                • Совместные маркетинговые кампании<br><br>
                
                <strong>🚚 Логистическое партнерство:</strong><br>
                • Доставка арендованных товаров<br>
                • Складские услуги<br>
                • Страхование при транспортировке<br><br>
                
                <strong>💻 Техническое партнерство:</strong><br>
                • API интеграция<br>
                • Разработка мобильных приложений<br>
                • Создание дополнительных сервисов<br><br>
                
                <strong>📈 Маркетинговое партнерство:</strong><br>
                • Кросс-промо в соцсетях<br>
                • Совместные акции и скидки<br>
                • Event-marketing<br><br>
                
                <strong>🏆 Что мы предлагаем:</strong><br>
                • Доступ к нашей аудитории (10,000+ активных пользователей)<br>
                • Техническую поддержку интеграции<br>
                • Маркетинговую поддержку<br>
                • Привлекательные финансовые условия<br><br>
                
                <strong>📞 Начнем сотрудничество:</strong><br>
                📧 Напишите нам: nadirkansabyr@gmail.com<br>
                📱 Или звоните: +7 (747) 200-70-77<br><br>
                
                Опишите ваше предложение — мы ответим в течение 24 часов!`
            },
            delivery: {
                title: 'Доставка',
                text: 'Удобная доставка арендованных вещей по всему городу. Мы привезём товар в указанное место и заберём его после окончания срока аренды.<br><br>🚚 Стоимость доставки рассчитывается индивидуально<br>⏱ Доставка в течение 2-4 часов<br>📦 Бережная упаковка и транспортировка'
            },
            insurance: {
                title: 'Страхование',
                text: '<strong>Защита вашего товара во время аренды</strong><br><br><strong>Покрытие:</strong><br>• Поломка товара<br>• Кража или утеря<br>• Случайное повреждение<br>• Механические повреждения<br><br><strong>Стоимость:</strong><br>Страховка может быть включена в стоимость аренды или приобретается отдельно (5-10% от стоимости товара).<br><br><strong>Условия:</strong><br>В случае наступления страхового случая необходимо:<br>1. Немедленно уведомить владельца и службу поддержки<br>2. Предоставить фото/видео повреждений<br>3. Заполнить акт о происшествии<br>4. Предоставить документы (при краже - справка из полиции)<br><br><strong>Франшиза:</strong><br>В зависимости от типа товара франшиза составляет 10-20% от стоимости ремонта. Эту сумму арендатор оплачивает самостоятельно.'
            },
            guarantee: {
                title: 'Гарантия',
                text: '<strong>Уверенность в качестве и работоспособности оборудования</strong><br><br><strong>Работоспособность:</strong><br>Мы гарантируем, что все товары на платформе будут в полностью рабочем состоянии на момент передачи арендатору. Каждый товар проверяется владельцем перед арендой.<br><br><strong>Случаи неработоспособности:</strong><br>Если товар сломался не по вине арендатора:<br>• Бесплатная замена на аналогичный товар<br>• Срочный ремонт за счёт владельца<br>• Полный возврат денег за неиспользованный период<br>• Компенсация неудобств<br><br><strong>Сроки:</strong><br>Гарантия действует на весь период аренды. Если товар вышел из строя по техническим причинам, вы имеете право на возврат средств или замену.<br><br><strong>Исключения:</strong><br>Гарантия не распространяется на случаи:<br>• Нарушения правил эксплуатации<br>• Механических повреждений по вине арендатора<br>• Использования товара не по назначению<br>• Самостоятельного ремонта без согласования'
            },
            support: {
                title: 'Помощь и поддержка',
                text: '<strong>Мы всегда готовы помочь вам!</strong><br><br><strong>Часто задаваемые вопросы (FAQ):</strong><br><br><strong>Как арендовать вещь?</strong><br>Найдите нужный товар, выберите даты, свяжитесь с владельцем и договоритесь о встрече.<br><br><strong>Как происходит оплата?</strong><br>Оплата производится наличными или переводом при встрече с владельцем. Безопасные платежи через платформу - в разработке.<br><br><strong>Что делать, если товар повреждён?</strong><br>Немедленно свяжитесь с владельцем и службой поддержки. Мы поможем решить вопрос.<br><br><strong>Можно ли продлить аренду?</strong><br>Да, свяжитесь с владельцем через чат и договоритесь о продлении.<br><br><strong>Контакты службы поддержки:</strong><br>📱 Телефон: +7 (747) 200-70-77<br>📧 Email: nadirkansabyr@gmail.com<br>💬 Онлайн-чат на сайте<br>⏰ Часы работы: 24/7 (круглосуточно)<br><br><strong>Инструкции:</strong><br>• <a href="#" style="color:#0ea5e9;">Как пользоваться сайтом</a><br>• <a href="#" style="color:#0ea5e9;">Как безопасно сдавать вещи</a><br>• <a href="#" style="color:#0ea5e9;">Правила общения с арендаторами</a>'
            }
        };

        window.openInfoModal = function(type, event) {
            if (event) event.preventDefault();
            
            const modal = document.getElementById('infoModal');
            const content = document.getElementById('infoModalContent');
            const info = infoContent[type];
            
            if (info) {
                content.innerHTML = `
                    <h2 style="margin-top:0; margin-bottom:1.5rem; color:#111; font-size:1.75rem;">${info.title}</h2>
                    <p style="color:#374151; line-height:1.8; font-size:1.05rem;">${info.text}</p>
                `;
                modal.style.display = 'block';
            }
        };

        document.getElementById('closeInfoModal').addEventListener('click', function() {
            document.getElementById('infoModal').style.display = 'none';
        });

        document.getElementById('infoModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.style.display = 'none';
            }
        });

        // Interactive Steps Accordion Animation
        document.addEventListener('DOMContentLoaded', function() {
            const steps = document.querySelectorAll('.step');
            
            steps.forEach((step) => {
                step.addEventListener('click', function() {
                    const isActive = this.classList.contains('active');
                    
                    // Close all steps
                    steps.forEach(s => {
                        s.classList.remove('active', 'inactive');
                    });
                    
                    // If clicked step wasn't active, open it
                    if (!isActive) {
                        this.classList.add('active');
                        
                        // Make other steps inactive
                        steps.forEach(s => {
                            if (s !== this) {
                                s.classList.add('inactive');
                            }
                        });
                    }
                });
                
                // Touch support for mobile
                step.addEventListener('touchstart', function(e) {
                    // Don't prevent default to allow normal scrolling
                }, { passive: true });
            });
        });
    </script>
</body>
</html>

TEST CHANGE 11/27/2025 21:34:09
